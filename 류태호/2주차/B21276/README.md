### 📌 문제 정보

- **번호:** 21276  
- **제목:** 계보 복원가 호석
- **난이도:** Gold 2  
- **분류:** 위상 정렬, 그래프, 자료구조

---

### 💡 접근 방식

> 입력으로 주어지는 정보는 “조상 관계”이며, 이를 바탕으로 각 가문의 시조와 직계 부모-자식 관계를 복원하는 문제입니다.  
> 조상 관계는 방향 그래프로 표현하고, 위상 정렬을 이용해 직계 관계를 추출했습니다.

---

### 🔹 1단계 – 이름 정렬 및 인덱스 매핑

- 사람들의 이름을 미리 사전순으로 정렬했습니다.
- 이름 → 인덱스 매핑을 통해 배열 기반 처리를 가능하게 했습니다.

---

### 🔹 2단계 – 조상 그래프 구성

- 입력 `"X Y"`는 X의 조상 중에 Y가 있는 것을 의미하므로, Y(부모) -> X(자식) 방향의 그래프를 구성
- 처음에는 자식 -> 부모 방향의 그래프를 구성했지만, 위상 정렬을 위해 부모 -> 자식 방향으로 변경
- `family.get(parent).add(child)`과 `indegree[child]++` 형태로 그래프와 진입 차수를 구성
- 이 단계에서는 “조상 → 후손(전체)” 관계를 저장
---

### 🔹 3단계 – 루트 찾기
- `indegree == 0` 인 사람들은 조상이 없는 사람
- 이들이 각 가문의 시조
---

### 🔹 4단계 – 위상 정렬로 직계 관계 복원
- 위상 정렬을 통해 직계 가족을 구해야 함
- `indegree == 0` 이 되는 순간의 `parent`가 해당 노드의 직계 부모가 됨
- `direct` 맵에 직계 자식만 저장

---

### 🔹 5단계 – 출력

- 가문의 개수
- 시조 목록 (사전순)
- 각 사람과 직계 자식 수 및 자식 목록 (사전순)

---

### 💻 핵심 로직 (위상 정렬을 이용한 직계 자식 구하기)

```java
while (!queue.isEmpty()) {
    String parent = queue.poll();

    for (String child : family.get(parent)) {
        int idx = graph.get(child);
        tmpIndegree[idx]--;

        if (tmpIndegree[idx] == 0) {
            direct.get(parent).add(child);
            queue.add(child);
        }
    }
}
```

---

### ⏳ 복잡도 분석

- **시간 복잡도:**  
  O(N + M)  
  (그래프 구성 + 위상 정렬)

- **공간 복잡도:**  
  O(N + M)  
  (그래프, 진입 차수, 직계 자식 저장 구조)

---
### 🆕 알게 된 점 – 위상 정렬 정리

이번 문제를 통해 위상 정렬(Topological Sort)의 개념과 활용 방법을 명확히 이해하게 되었습니다.

#### 🔹 위상 정렬이란?

- 방향 그래프에서 간선의 방향을 거스르지 않도록 정점을 나열하는 방법
- 반드시 **사이클이 없는 방향 그래프(DAG)** 에서만 적용 가능
- 선행 관계가 있는 문제에서 “처리 순서”를 정하는 알고리즘

즉,  
A → B 관계가 있다면  
정렬 결과에서 A는 항상 B보다 먼저 등장해야 합니다.

---

#### 🔹 알게된 점

- **진입 차수 (indegree)**  
  → 해당 노드로 들어오는 간선의 수  
  → 선행 조건의 개수

- **indegree == 0**  
  → 선행 조건이 없는 노드  
  → 가장 먼저 처리 가능한 노드

- **Kahn 알고리즘(BFS 기반 위상 정렬)**
    1. indegree가 0인 노드를 큐에 넣는다.
    2. 큐에서 노드를 하나 꺼낸다.
    3. 해당 노드와 연결된 다음 노드들의 indegree를 감소시킨다.
    4. indegree가 0이 되면 큐에 추가한다.
    5. 큐가 빌 때까지 반복한다.

---

#### 🔹 이번 문제에서의 활용

- 조상 → 후손 관계를 방향 그래프로 구성
- indegree는 “조상 수”를 의미
- indegree가 0인 사람은 시조(루트)
- 위상 정렬 과정에서 indegree가 0이 되는 순간의 parent가 직계 부모가 됨

---

#### 🔹 위상 정렬을 사용하는 대표적인 상황

1. 선후 관계가 존재하는 문제
- 선수 과목 문제
- 작업 스케줄링
- 빌드 순서 결정

2. 계층 구조 복원 문제
- 가계도 복원
- 조직도 구성
- 상하 관계가 명확한 트리 복원

3. 의존성이 있는 시스템 문제
- 어떤 작업이 다른 작업에 의존할 때
- 순환이 없어야 하는 구조
